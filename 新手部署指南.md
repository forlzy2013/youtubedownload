# æ–°æ‰‹éƒ¨ç½²æŒ‡å— - ä¸€é”®è‡ªåŠ¨åŒ–éƒ¨ç½²

## ğŸ¯ ç›®æ ‡

ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä¸€é”®éƒ¨ç½²åˆ° Vercel å’Œ Renderï¼Œæ— éœ€æ‰‹åŠ¨åœ¨ç½‘é¡µä¸Šæ“ä½œã€‚

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œï¼ˆåªéœ€åšä¸€æ¬¡ï¼‰

### 1. å®‰è£…å¿…éœ€è½¯ä»¶

#### Windows ç”¨æˆ·ï¼š
```powershell
# å®‰è£… Node.js 20+
# ä¸‹è½½: https://nodejs.org/

# éªŒè¯å®‰è£…
node --version
npm --version
```

#### Mac/Linux ç”¨æˆ·ï¼š
```bash
# ä½¿ç”¨ nvm å®‰è£… Node.js
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20
```

### 2. å®‰è£… Vercel CLI

```bash
npm install -g vercel
```

### 3. è·å– API å¯†é’¥

#### 3.1 RapidAPI Key
1. è®¿é—® https://rapidapi.com/
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. è®¢é˜…ä»¥ä¸‹ 3 ä¸ª APIï¼ˆå…è´¹ç‰ˆï¼‰ï¼š
   - youtube-mp36
   - youtube-mp3-2025
   - youtube-info-download-api
4. å¤åˆ¶ä½ çš„ API Key

#### 3.2 Upstash Redis
1. è®¿é—® https://console.upstash.com/
2. åˆ›å»º Redis æ•°æ®åº“
3. å¤åˆ¶ REST URL å’Œ REST TOKEN

#### 3.3 Cloudflare R2
1. è®¿é—® https://dash.cloudflare.com/
2. åˆ›å»º R2 bucket: `youtube-mp3-downloads`
3. ç”Ÿæˆ API Token
4. å¤åˆ¶ Endpoint, Access Key, Secret Key, Public URL

#### 3.4 Render API Key
1. è®¿é—® https://dashboard.render.com/account/api-keys
2. åˆ›å»ºæ–°çš„ API Key
3. å¤åˆ¶ API Keyï¼ˆæ ¼å¼ï¼šrnd_xxxxxï¼‰

### 4. é…ç½®ç¯å¢ƒå˜é‡

#### 4.1 åˆ›å»º `.env.local` æ–‡ä»¶

å¤åˆ¶ `.env.example` å¹¶é‡å‘½åä¸º `.env.local`ï¼Œç„¶åå¡«å…¥çœŸå®å€¼ï¼š

```bash
# RapidAPIé…ç½®
RAPIDAPI_KEY=ä½ çš„_RapidAPI_å¯†é’¥
RAPIDAPI_HOST_1=youtube-mp36.p.rapidapi.com
RAPIDAPI_HOST_2=youtube-mp3-2025.p.rapidapi.com
RAPIDAPI_HOST_3=youtube-info-download-api.p.rapidapi.com

# Upstash Redisé…ç½®
UPSTASH_REDIS_REST_URL=https://ä½ çš„-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=ä½ çš„_Redis_Token

# Cloudflare R2é…ç½®
R2_ENDPOINT=https://ä½ çš„è´¦æˆ·ID.r2.cloudflarestorage.com
R2_ACCESS_KEY_ID=ä½ çš„_R2_Access_Key
R2_SECRET_ACCESS_KEY=ä½ çš„_R2_Secret_Key
R2_BUCKET_NAME=youtube-mp3-downloads
R2_PUBLIC_URL=https://pub-ä½ çš„ID.r2.dev

# Render Worker URLï¼ˆé¦–æ¬¡éƒ¨ç½²åä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰
RENDER_WORKER_URL=https://youtube-mp3-worker.onrender.com

# Render API Keyï¼ˆç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰
RENDER_API_KEY=rnd_ä½ çš„_Render_API_Key

# APIé…é¢é™åˆ¶
RAPIDAPI_1_MONTHLY_QUOTA=300
RAPIDAPI_2_MONTHLY_QUOTA=300
RAPIDAPI_3_DAILY_QUOTA=500
```

#### 4.2 åˆ›å»º `worker/.env` æ–‡ä»¶

å¤åˆ¶ `worker/.env.example` å¹¶é‡å‘½åä¸º `worker/.env`ï¼Œå¡«å…¥ç›¸åŒçš„å€¼ï¼š

```bash
# Upstash Redisé…ç½®
UPSTASH_REDIS_REST_URL=https://ä½ çš„-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=ä½ çš„_Redis_Token

# Cloudflare R2é…ç½®
R2_ENDPOINT=https://ä½ çš„è´¦æˆ·ID.r2.cloudflarestorage.com
R2_ACCESS_KEY_ID=ä½ çš„_R2_Access_Key
R2_SECRET_ACCESS_KEY=ä½ çš„_R2_Secret_Key
R2_BUCKET_NAME=youtube-mp3-downloads
R2_PUBLIC_URL=https://pub-ä½ çš„ID.r2.dev

# ä»»åŠ¡é…ç½®
MAX_CONCURRENT_TASKS=3
TASK_TIMEOUT=120000
```

---

## ğŸš€ ä¸€é”®éƒ¨ç½²

### æ–¹æ³• 1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. å®‰è£…é¡¹ç›®ä¾èµ–
npm install

# 2. è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
npm run deploy
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æŸ¥ç¯å¢ƒå˜é‡
2. âœ… ç™»å½• Vercelï¼ˆé¦–æ¬¡éœ€è¦æˆæƒï¼‰
3. âœ… éƒ¨ç½²å‰ç«¯å’Œ API åˆ° Vercel
4. âœ… åˆ›å»º Render Worker æœåŠ¡
5. âœ… é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡
6. âœ… æ˜¾ç¤ºéƒ¨ç½²ç»“æœå’Œä¸‹ä¸€æ­¥æ“ä½œ

### æ–¹æ³• 2: åˆ†æ­¥éƒ¨ç½²

```bash
# åªéƒ¨ç½² Vercel
npm run deploy:vercel

# åªéƒ¨ç½² Render
npm run deploy:render
```

---

## ğŸ“ éƒ¨ç½²åçš„æ“ä½œ

### 1. æ›´æ–° Vercel ç¯å¢ƒå˜é‡

éƒ¨ç½²å®Œæˆåï¼Œè„šæœ¬ä¼šæ˜¾ç¤º Render Worker çš„ URLï¼Œä¾‹å¦‚ï¼š
```
https://youtube-mp3-worker.onrender.com
```

ä½ éœ€è¦ï¼š
1. è®¿é—® https://vercel.com/dashboard
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ Settings â†’ Environment Variables
4. æ·»åŠ æˆ–æ›´æ–°ï¼š
   ```
   RENDER_WORKER_URL = https://youtube-mp3-worker.onrender.com
   ```
5. ç‚¹å‡» Save
6. é‡æ–°éƒ¨ç½² Vercelï¼ˆåœ¨ Deployments é¡µé¢ç‚¹å‡» Redeployï¼‰

### 2. è®¾ç½® CRON ä»»åŠ¡ï¼ˆé˜²æ­¢ Render ä¼‘çœ ï¼‰

1. è®¿é—® https://cron-job.org
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. åˆ›å»ºæ–°çš„ CRON ä»»åŠ¡ï¼š
   - **Title:** Keep Render Worker Alive
   - **URL:** `https://youtube-mp3-worker.onrender.com/health`
   - **Schedule:** `*/10 * * * *` (æ¯ 10 åˆ†é’Ÿ)
   - **Timezone:** UTC
4. ä¿å­˜å¹¶å¯ç”¨

### 3. ç­‰å¾… Render é¦–æ¬¡æ„å»º

Render é¦–æ¬¡éƒ¨ç½²éœ€è¦ 5-10 åˆ†é’Ÿæ¥ï¼š
- æ„å»º Docker é•œåƒ
- å®‰è£… yt-dlp å’Œ ffmpeg
- å¯åŠ¨æœåŠ¡

ä½ å¯ä»¥åœ¨ Render æ§åˆ¶å°æŸ¥çœ‹æ„å»ºæ—¥å¿—ï¼š
https://dashboard.render.com/

### 4. æµ‹è¯•éƒ¨ç½²

ç­‰å¾… Render æ„å»ºå®Œæˆåï¼Œè¿è¡Œæµ‹è¯•ï¼š

```bash
# è®¾ç½®æµ‹è¯• URL
export BASE_URL=https://ä½ çš„é¡¹ç›®.vercel.app
export WORKER_URL=https://youtube-mp3-worker.onrender.com

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### æ£€æŸ¥ Vercel

1. è®¿é—®ä½ çš„ Vercel URL
2. åº”è¯¥çœ‹åˆ°é¡¹ç›®é¦–é¡µ
3. å°è¯•è¾“å…¥ YouTube URL å¹¶ç‚¹å‡» "Analyze"

### æ£€æŸ¥ Render Worker

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://youtube-mp3-worker.onrender.com/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","uptime":123,"timestamp":1234567890,"queueSize":0}
```

### æ£€æŸ¥ Redis

```bash
# æµ‹è¯• Redis è¿æ¥
curl -H "Authorization: Bearer ä½ çš„_REDIS_TOKEN" \
  https://ä½ çš„-redis.upstash.io/ping

# åº”è¯¥è¿”å›ï¼š
# {"result":"PONG"}
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: Vercel éƒ¨ç½²å¤±è´¥

**é”™è¯¯:** `Error: No token found`

**è§£å†³:**
```bash
vercel logout
vercel login
```

### Q2: Render API è¿”å› 401

**é”™è¯¯:** `Unauthorized`

**è§£å†³:**
1. æ£€æŸ¥ RENDER_API_KEY æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿ API Key æ²¡æœ‰è¿‡æœŸ
3. é‡æ–°ç”Ÿæˆ API Key

### Q3: ç¯å¢ƒå˜é‡ç¼ºå¤±

**é”™è¯¯:** `Missing required environment variable: XXX`

**è§£å†³:**
1. æ£€æŸ¥ `.env.local` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„å˜é‡éƒ½å·²å¡«å†™
3. å˜é‡å€¼ä¸è¦æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–å¼•å·

### Q4: Render æœåŠ¡å·²å­˜åœ¨

**æç¤º:** `Service already exists`

**è§£å†³:**
è¿™æ˜¯æ­£å¸¸çš„ã€‚å¦‚æœæœåŠ¡å·²å­˜åœ¨ï¼Œè„šæœ¬ä¼šè·³è¿‡åˆ›å»ºã€‚
å¦‚éœ€é‡æ–°éƒ¨ç½²ï¼Œåœ¨ Render æ§åˆ¶å°æ‰‹åŠ¨è§¦å‘éƒ¨ç½²ã€‚

### Q5: é¦–æ¬¡è®¿é—®å¾ˆæ…¢

**åŸå› :** Render å…è´¹ç‰ˆä¼šåœ¨ 15 åˆ†é’Ÿä¸æ´»åŠ¨åä¼‘çœ 

**è§£å†³:**
1. ç¡®ä¿ CRON ä»»åŠ¡å·²è®¾ç½®å¹¶è¿è¡Œ
2. é¦–æ¬¡è®¿é—®ç­‰å¾… 30-60 ç§’è®©æœåŠ¡å”¤é†’
3. CRON ä»»åŠ¡è¿è¡Œåï¼Œå“åº”ä¼šå¾ˆå¿«

---

## ğŸ“Š éƒ¨ç½²æˆæœ¬

æ‰€æœ‰æœåŠ¡éƒ½ä½¿ç”¨å…è´¹ç‰ˆï¼š

| æœåŠ¡ | å…è´¹é¢åº¦ | æœˆæˆæœ¬ |
|------|---------|--------|
| Vercel | 100GB å¸¦å®½, 1M å‡½æ•°è°ƒç”¨ | $0 |
| Render | 750 å°æ—¶/æœˆ | $0 |
| RapidAPI | 900 è¯·æ±‚/æœˆï¼ˆ3ä¸ªAPIï¼‰ | $0 |
| Upstash Redis | 300K è¯·æ±‚/æœˆ | $0 |
| Cloudflare R2 | 10GB å­˜å‚¨, 10M è¯»å– | $0 |
| cron-job.org | æ— é™ä»»åŠ¡ | $0 |

**æ€»è®¡: $0/æœˆ** ğŸ‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼š

1. âœ… æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. âœ… åˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜
3. âœ… è®¾ç½®ç›‘æ§å’Œå‘Šè­¦
4. âœ… å®šæœŸæ£€æŸ¥ API é…é¢ä½¿ç”¨æƒ…å†µ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

1. æŸ¥çœ‹ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. æŸ¥çœ‹ [DEPLOYMENT.md](DEPLOYMENT.md)
3. æŸ¥çœ‹è‡ªåŠ¨åŒ–éƒ¨ç½²æ—¥å¿—

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€
