# éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

## âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥ç»“æœ

ä½ çš„ç¯å¢ƒå˜é‡é…ç½®å·²ç»**å®Œå…¨æ­£ç¡®**ï¼æ‰€æœ‰å¿…éœ€çš„é…ç½®éƒ½å·²å°±ç»ªã€‚

---

## ğŸ“‹ é…ç½®æ‘˜è¦

### âœ… RapidAPI é…ç½®
- **API Key:** âœ… å·²é…ç½®ï¼ˆ2411876baa...22fecï¼‰
- **API Host 1:** âœ… youtube-mp36.p.rapidapi.com
- **API Host 2:** âœ… youtube-mp3-2025.p.rapidapi.com
- **API Host 3:** âœ… youtube-info-download-api.p.rapidapi.com

### âœ… Upstash Redis é…ç½®
- **REST URL:** âœ… https://amazed-quagga-6163.upstash.io
- **REST Token:** âœ… å·²é…ç½®ï¼ˆARgTAAImcD...jE2Mwï¼‰

### âœ… Cloudflare R2 é…ç½®
- **Endpoint:** âœ… https://92e41f3c8ef664503660f8fb563d604.r2.cloudflarestorage.com
- **Access Key ID:** âœ… å·²é…ç½®ï¼ˆe869fc7504...598f9ï¼‰
- **Secret Access Key:** âœ… å·²é…ç½®ï¼ˆb34670109e...d8b69ï¼‰
- **Bucket Name:** âœ… youtube-mp3-downloads
- **Public URL:** âœ… https://pub-26a6e40311764f32b576bbb68ff6f8ba.r2.dev

### âœ… Render é…ç½®
- **API Key:** âœ… å·²é…ç½®ï¼ˆrnd_MboxR4...HNRy4ï¼‰
- **Worker URL:** âœ… https://youtube-mp3-worker.onrender.com

### âœ… API é…é¢è®¾ç½®
- **API 1 æœˆé…é¢:** 300
- **API 2 æœˆé…é¢:** 300
- **API 3 æ—¥é…é¢:** 2000

---

## ğŸš€ å‡†å¤‡éƒ¨ç½²

### ç¬¬ä¸€æ­¥ï¼šæœ€åæ£€æŸ¥

è¿è¡Œæ£€æŸ¥è„šæœ¬ç¡®è®¤ä¸€åˆ‡æ­£å¸¸ï¼š

```bash
npm run check
```

### ç¬¬äºŒæ­¥ï¼šå¼€å§‹éƒ¨ç½²

```bash
npm run deploy
```

è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æŸ¥æ‰€æœ‰ç¯å¢ƒå˜é‡
2. âœ… ç™»å½• Vercelï¼ˆé¦–æ¬¡éœ€è¦æµè§ˆå™¨æˆæƒï¼‰
3. âœ… éƒ¨ç½²å‰ç«¯å’Œ API åˆ° Vercel
4. âœ… é€šè¿‡ Render API åˆ›å»º Worker æœåŠ¡
5. âœ… é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡åˆ° Render
6. âœ… æ˜¾ç¤ºéƒ¨ç½²ç»“æœå’Œä¸‹ä¸€æ­¥æ“ä½œ

---

## â±ï¸ é¢„è®¡æ—¶é—´

- **Vercel éƒ¨ç½²:** 2-3 åˆ†é’Ÿ
- **Render æœåŠ¡åˆ›å»º:** 1 åˆ†é’Ÿ
- **Render é¦–æ¬¡æ„å»º:** 5-10 åˆ†é’Ÿï¼ˆåå°è¿›è¡Œï¼‰

**æ€»è®¡:** çº¦ 3-4 åˆ†é’Ÿï¼ˆä¸åŒ…æ‹¬ Render æ„å»ºæ—¶é—´ï¼‰

---

## ğŸ“ éƒ¨ç½²åéœ€è¦åšçš„äº‹

éƒ¨ç½²è„šæœ¬å®Œæˆåï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„ä¸‹ä¸€æ­¥æ“ä½œã€‚ä¸»è¦åŒ…æ‹¬ï¼š

### 1. æ›´æ–° Vercel ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰

Render Worker éƒ¨ç½²åä¼šç”Ÿæˆä¸€ä¸ª URLï¼Œä½ éœ€è¦ï¼š

1. è®¿é—® https://vercel.com/dashboard
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ Settings â†’ Environment Variables
4. æ›´æ–° `RENDER_WORKER_URL` ä¸ºå®é™…çš„ Render URL
5. é‡æ–°éƒ¨ç½² Vercel

### 2. è®¾ç½® CRON ä»»åŠ¡ï¼ˆé˜²æ­¢ä¼‘çœ ï¼‰

1. è®¿é—® https://cron-job.org
2. æ³¨å†Œ/ç™»å½•
3. åˆ›å»ºæ–°ä»»åŠ¡ï¼š
   - URL: `https://youtube-mp3-worker.onrender.com/health`
   - é¢‘ç‡: `*/10 * * * *` (æ¯ 10 åˆ†é’Ÿ)
   - æ—¶åŒº: UTC
4. ä¿å­˜å¹¶å¯ç”¨

### 3. ç­‰å¾… Render æ„å»ºå®Œæˆ

- é¦–æ¬¡éƒ¨ç½²éœ€è¦ 5-10 åˆ†é’Ÿ
- å¯ä»¥åœ¨ Render æ§åˆ¶å°æŸ¥çœ‹è¿›åº¦
- æ„å»ºå®ŒæˆåæœåŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨

### 4. æµ‹è¯•éƒ¨ç½²

```bash
# ç­‰å¾… Render æ„å»ºå®Œæˆåè¿è¡Œ
npm run test:e2e
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### æ£€æŸ¥ Vercel

è®¿é—®ä½ çš„ Vercel URLï¼ˆéƒ¨ç½²åä¼šæ˜¾ç¤ºï¼‰ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
- âœ… é¡¹ç›®é¦–é¡µæ­£å¸¸æ˜¾ç¤º
- âœ… å¯ä»¥è¾“å…¥ YouTube URL
- âœ… ç‚¹å‡» "Analyze" æŒ‰é’®æœ‰å“åº”

### æ£€æŸ¥ Render Worker

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥ï¼ˆç­‰å¾…æ„å»ºå®Œæˆåï¼‰
curl https://youtube-mp3-worker.onrender.com/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","uptime":123,"timestamp":1234567890,"queueSize":0}
```

### æ£€æŸ¥ Redis è¿æ¥

```bash
# æµ‹è¯• Redis
curl -H "Authorization: Bearer ARgTAAImcDJlZmFkODdiNTE3NTg0ODcwOGUwNmJkZDY1MGNjNzczY3AyNjE2Mw" \
  https://amazed-quagga-6163.upstash.io/ping

# åº”è¯¥è¿”å›ï¼š
# {"result":"PONG"}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Render é¦–æ¬¡éƒ¨ç½²è¾ƒæ…¢

- éœ€è¦æ„å»º Docker é•œåƒ
- å®‰è£… yt-dlp å’Œ ffmpeg
- é¦–æ¬¡å¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¯·è€å¿ƒç­‰å¾…

### 2. Vercel é¦–æ¬¡ç™»å½•

- è¿è¡Œ `npm run deploy` æ—¶
- å¦‚æœæœªç™»å½• Vercelï¼Œä¼šæ‰“å¼€æµè§ˆå™¨
- æˆæƒåä¼šè‡ªåŠ¨ç»§ç»­éƒ¨ç½²

### 3. ç¯å¢ƒå˜é‡æ›´æ–°

- éƒ¨ç½²åè®°å¾—æ›´æ–° Vercel çš„ `RENDER_WORKER_URL`
- å¦åˆ™ Fast Track å¤±è´¥åæ— æ³•åˆ‡æ¢åˆ° Stable Track

### 4. CRON ä»»åŠ¡å¾ˆé‡è¦

- ä¸è®¾ç½® CRONï¼ŒRender ä¼šåœ¨ 15 åˆ†é’Ÿåä¼‘çœ 
- é¦–æ¬¡è¯·æ±‚éœ€è¦ 30-60 ç§’å”¤é†’
- è®¾ç½®åå“åº”æ—¶é—´ <5 ç§’

---

## ğŸ¯ æˆåŠŸæ ‡å¿—

éƒ¨ç½²æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- âœ… è®¿é—® Vercel URL çœ‹åˆ°é¡¹ç›®é¦–é¡µ
- âœ… è¾“å…¥ YouTube URL å¹¶è·å–è§†é¢‘ä¿¡æ¯
- âœ… ç‚¹å‡»ä¸‹è½½æŒ‰é’®å¼€å§‹ä¸‹è½½
- âœ… Fast Track åœ¨ 3-5 ç§’å†…å®Œæˆ
- âœ… Stable Track åœ¨ 30-60 ç§’å†…å®Œæˆ
- âœ… ä¸‹è½½å†å²æ­£å¸¸ä¿å­˜
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### å¸¸è§é—®é¢˜

1. **Vercel ç™»å½•å¤±è´¥**
   ```bash
   vercel logout
   vercel login
   ```

2. **Render API è¿”å› 401**
   - æ£€æŸ¥ RENDER_API_KEY æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿ API Key ä»¥ `rnd_` å¼€å¤´

3. **ç¯å¢ƒå˜é‡ç¼ºå¤±**
   - è¿è¡Œ `npm run check` å†æ¬¡æ£€æŸ¥
   - ç¡®ä¿ `.env.local` å’Œ `worker/.env` éƒ½å·²é…ç½®

4. **éƒ¨ç½²å¤±è´¥**
   - æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤æ‰€æœ‰ API Key éƒ½æœ‰æ•ˆ

### è·å–å¸®åŠ©

1. æŸ¥çœ‹ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. æŸ¥çœ‹ [æ–°æ‰‹éƒ¨ç½²æŒ‡å—.md](æ–°æ‰‹éƒ¨ç½²æŒ‡å—.md)
3. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

---

## âœ… æœ€ç»ˆæ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [x] Node.js 20+ å·²å®‰è£…
- [x] Vercel CLI å·²å®‰è£…
- [x] `.env.local` å·²é…ç½®æ‰€æœ‰å˜é‡
- [x] `worker/.env` å·²é…ç½®
- [x] æ‰€æœ‰ API Key éƒ½æœ‰æ•ˆ
- [x] ç½‘ç»œè¿æ¥æ­£å¸¸
- [x] è¿è¡Œ `npm run check` é€šè¿‡

**ä¸€åˆ‡å°±ç»ªï¼ç°åœ¨å¯ä»¥è¿è¡Œï¼š**

```bash
npm run deploy
```

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å¹¶å‚è€ƒæ•…éšœæ’é™¤æ–‡æ¡£ã€‚
